(this.webpackJsonpemilus=this.webpackJsonpemilus||[]).push([[24],{461:function(e,t,s){"use strict";var a=s(475),r=s.n(a),n=s(32),o=s(476).a(),c=s(29),l=s(265);const i=r.a.create({baseURL:n.a,timeout:6e4}),d="/auth/login";i.interceptors.request.use((e=>{const t=localStorage.getItem(c.b);return t&&(e.headers.authorization=t),t||e.headers["public-request"]||(o.push(d),window.location.reload()),e}),(e=>{l.a.error({message:"Error"}),Promise.reject(e)})),i.interceptors.response.use((e=>e.data),(e=>{let t={message:""};return e.response&&(400!==e.response.status&&403!==e.response.status&&401!==e.response.status||(t.message="Authentication Fail",t.description="Please login again",localStorage.removeItem(c.b),o.push(d),window.location.reload()),404===e.response.status&&(t.message="Not Found"),500===e.response.status&&(t.message="Internal Server Error"),508===e.response.status&&(t.message="Time Out"),l.a.error(t)),Promise.reject(e)}));t.a=i},470:function(e,t,s){"use strict";var a=s(461);const r={getByID:function(e){return a.a.get("/students/".concat(e))},getAll:function(e){return a.a.get("/students",{params:e})},delete:function(e){return a.a.delete("/students/".concat(e))},update:function(e,t){return a.a.post("/students/".concat(e),t)},create:function(e){return a.a.post("/students",e)},copy:function(e){return a.a.post("/students/".concat(e,"/copy"))},import:function(e){const t=new FormData;return t.append("attachment",e),a.a.post("/students/import",t,{headers:{"Content-Type":"multipart/form-data"}})},exportAll:function(e){if("xlsx"!==e&&"csv"!==e)throw new Error("File type must be either xlsx or csv");return a.a.get("/students/export?type=".concat(e),{responseType:"blob"})},export:function(e,t){if("xlsx"!==t&&"csv"!==t)throw new Error("File type must be either xlsx or csv");return a.a.post("/students/export/".concat(t),{ids:e})}};t.a=r},478:function(e,t,s){"use strict";s(0);var a=s(429),r=s(1);const n=e=>Object(r.jsx)(a.a,{...e,className:"ant-avatar-".concat(e.type),children:e.text});t.a=e=>{const{name:t,suffix:s,subTitle:a,id:o,type:c,src:l,icon:i,size:d,shape:u,gap:p,text:x,onNameClick:b}=e;return Object(r.jsxs)("div",{className:"avatar-status d-flex align-items-center",children:[n({icon:i,src:l,type:c,size:d,shape:u,gap:p,text:x}),Object(r.jsxs)("div",{className:"ml-2",children:[Object(r.jsxs)("div",{children:[b?Object(r.jsx)("div",{onClick:()=>b({name:t,subTitle:a,src:l,id:o}),className:"avatar-status-name clickable",children:t}):Object(r.jsx)("div",{className:"avatar-status-name",children:t}),Object(r.jsx)("span",{children:s})]}),Object(r.jsx)("div",{className:"text-muted avatar-status-subtitle",children:a})]})]})}},620:function(e,t,s){"use strict";s.r(t);var a=s(0),r=s(79),n=s(264),o=s(636),c=s(110),l=s(633),i=s(470),d=s(478),u=s(116),p=s(51),x=s(1);const{Option:b}=r.a;t.default=()=>{const[e,t]=Object(a.useState)([]),[s,m]=Object(a.useState)([]),[h,j]=Object(a.useState)(!1),[f,g]=Object(a.useState)("xlsx"),[y,O]=Object(a.useState)([]),[S,v]=Object(a.useState)([]);Object(a.useEffect)((()=>{(async()=>{try{j(!0);const e=await i.a.getAll();t(e.data||[])}catch(e){console.error("Error fetching students:",e),n.b.error("Failed to load students"),t([])}finally{j(!1)}})()}),[]),Object(a.useEffect)((()=>{m(e)}),[e]);const w=[{title:"ID",dataIndex:"id",render:(e,t,s)=>s+1,sorter:(e,t)=>e.id-t.id},{title:"Student Name",dataIndex:"fullname",render:(e,t)=>Object(x.jsx)("div",{className:"d-flex",children:Object(x.jsx)(d.a,{size:60,type:"square",src:t.attachment,name:t.fullname})}),sorter:(e,t)=>p.a.antdTableSorter(e,t,"name")},{title:"Student Code",dataIndex:"code",sorter:(e,t)=>p.a.antdTableSorter(e,t,"code")},{title:"Gender",dataIndex:"sex",sorter:(e,t)=>p.a.antdTableSorter(e,t,"sex")},{title:"Date of Birth",dataIndex:"dob",sorter:(e,t)=>p.a.antdTableSorter(e,t,"dob")},{title:"Home City",dataIndex:"homecity",sorter:(e,t)=>p.a.antdTableSorter(e,t,"homecity")},{title:"Address",dataIndex:"address",sorter:(e,t)=>p.a.antdTableSorter(e,t,"address")},{title:"Phone",dataIndex:"phone",sorter:(e,t)=>p.a.antdTableSorter(e,t,"phone")},{title:"Email",dataIndex:"email",sorter:(e,t)=>p.a.antdTableSorter(e,t,"email")},{title:"Class",dataIndex:"class_id",sorter:(e,t)=>p.a.antdTableSorter(e,t,"classid")},{title:"Username",dataIndex:"username",sorter:(e,t)=>p.a.antdTableSorter(e,t,"username")}],E={onChange:(e,t)=>{O(t),v(e)}};return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"mb-3",children:Object(x.jsx)(o.a,{children:Object(x.jsxs)(u.a,{alignItems:"center",justifyContent:"space-between",children:[Object(x.jsx)("h3",{className:"mb-0 mr-5",children:"Export Students"}),Object(x.jsxs)(u.a,{justifyContent:"flex-start",children:[Object(x.jsxs)(r.a,{defaultValue:"xlsx",style:{width:200},value:f,onChange:e=>{g(e)},placeholder:"Select file type",children:[Object(x.jsx)(b,{value:"xlsx",children:"Excel (.xlsx)"}),Object(x.jsx)(b,{value:"csv",children:"CSV (.csv)"})]}),Object(x.jsx)(c.a,{onClick:()=>{if(!f)return void n.b.error("Please select a file type");const e=y.length>0?y:s;if(0===e.length)return void n.b.warning("No data to export");if(0===y.length){return void(async()=>{try{j(!0);const e=await i.a.exportAll(f);if(console.log("Exported all students:",e),e)if(n.b.success("All students exported successfully as ".concat(f.toUpperCase())),e.url)window.open(e.url,"_blank");else{const t="xlsx"===f?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"text/csv";let s;s=e instanceof Blob?e:e.data?new Blob([e.data],{type:t}):new Blob([e],{type:t});const a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download="all_students_export_".concat((new Date).toISOString().split("T")[0],".").concat(f),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),r.remove()}}catch(e){console.error("Error exporting all students:",e),n.b.error("Failed to export all students: ".concat(e.message||"Unknown error"))}finally{j(!1)}})()}j(!0);(async()=>{try{const t={ids:e.map((e=>e.id))};console.log("Exporting with file type: ".concat(f,", params:"),t);const s=t.ids.join(","),a=new URLSearchParams;a.append("ids",s),a.append("type",f);const r="".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_BASE_URL||"","/api/students/export?").concat(a.toString());window.open(r,"_blank"),n.b.success("Students exported successfully as ".concat(f.toUpperCase())),j(!1)}catch(t){console.error("Error exporting students:",t),n.b.error("Failed to export students: ".concat(t.message||"Unknown error"))}finally{j(!1)}})()},type:"primary",loading:h,style:{marginLeft:16},disabled:0===s.length,children:y.length>0?"Export Selected (".concat(y.length,")"):"Export All"})]})]})})}),Object(x.jsx)(o.a,{children:Object(x.jsx)("div",{className:"table-responsive",children:Object(x.jsx)(l.a,{columns:w,dataSource:Array.isArray(s)?s:[],rowKey:"id",loading:h,rowSelection:{selectedRowKeys:S,type:"checkbox",...E}})})})]})}}}]);
//# sourceMappingURL=24.956f3089.chunk.js.map